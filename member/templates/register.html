<html>
	<head>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
		integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>

		<title>또아파 회원가입</title>

		<style type="text/css">
        
        body{
            margin-top:20px;
            background-color: #f2f3f8;
        }

        .card {
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 15px 1px rgba(52,40,104,.08);
        }

        .card {
            position: relative;
            display: -ms-flexbox;
            display: flex;
            -ms-flex-direction: column;
            flex-direction: column;
            min-width: 0;
            word-wrap: break-word;
            background-color: #fff;
            background-clip: border-box;
            border: 1px solid #e5e9f2;
            border-radius: .2rem;
        }

        </style>
	</head>

    <body>
        <div class="container h-100">
            <div class="row h-100">
                <div class="col-sm-10 col-md-8 col-lg-6 mx-auto d-table h-100">
                    <div class="d-table-cell align-middle">
                        <div class="text-center mt-4">
                            <h1 class="h2">DDOAPPA 회원가입</h1>
                            <br><br>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <div class="m-sm-4">
                                    <form method="post">
                                        {% csrf_token %}
                                        <label>아이디</label>
                                        <div class="form-group input-group mt-3">
                                            <input class="form-control form-control-lg userid_input" type="id" name="id" placeholder="Enter ID" check_result="fail">
                                            <div class="input-group-append">
                                                <button class="btn btn-primary id_check_button" type="button" onclick="check_id();">중복 확인</button>
                                            </div>
                                        </div>
                                        <div class="form-group mt-3">
                                            <span id="id_check_success" style="display: none; color: royalblue; font-weight: bold;">사용 가능한 아이디입니다!</span>
                                            <span id="id_check_fail" style="display: none; color: #d92742; font-weight: bold; ">이미 사용 중인 아이디입니다! 다시 입력하삼</span>
                                        </div>
                                        <div class="form-group mt-3">
											<div class="form-outline">
												<label class="form-label" for="pw">비밀번호</label>
												<input type="password" id="pw" name="pw" class="form-control form-control-lg pw" placeholder="Enter password"/>
											</div>
                                            <div class="pw regex" style="color: #d92742; font-weight: bold;"></div>
                                            <div class="form-outline mt-3">
												<label class="form-label" for="chkpw">비밀번호 확인</label>
												<input type="password" id="chkpw" name="chkpw" class="form-control form-control-lg pw" placeholder="Enter password"/>
												<span id="alert-success" style="display: none; font-weight: bold;">비밀번호가 일치합니다.</span>
												<span id="alert-danger" style="display: none; color: #d92742; font-weight: bold; ">비밀번호가 일치하지 않습니다. 다시 입력하삼</span>
											</div>
										</div>
                                        <div class="form-group mt-3">
                                            <label>이름</label>
                                            <input class="form-control form-control-lg" type="text" name="name" placeholder="Enter your Name">
                                        </div>
                                        <div class="form-group mt-3">
                                            <label>이메일</label>
                                            <input class="form-control form-control-lg" type="email" name="email" id="email" placeholder="Enter your E-mail">
                                        </div>
                                        <div class="email regex" style="color: #d92742; font-weight: bold;"></div>
                                        <div class="form-group mt-3">
                                            <label>휴대폰 번호</label>
                                            <input class="form-control form-control-lg" type="tel" name="pNum" id="pNum" placeholder="Enter your Phonenumber">
                                        </div>
                                        <div class="phone regex" style="color: #d92742; font-weight: bold;"></div>
                                        <div class="form-group mt-3">
                                            <label>성별</label>
                                            <span class="ml-3">
                                                <div class="form-check form-check-inline mt-2">
                                                    <input class="form-check-input" type="radio" name="gender" value="M" checked />
                                                    <label class="form-check-label">남성(Male)</label>
                                                </div>
                                                <div class="form-check form-check-inline mt-2">
                                                    <input class="form-check-input" type="radio" name="gender" value="W" />
                                                    <label class="form-check-label">여성(Female)</label>
                                                </div>
                                            </span>
                                        </div>
                                        <div class="form-group mt-4">
                                            <label>직업</label>
                                            <select class="select form-control-sm ml-3" id="job" name="job">
                                                <option value="" selected>선택</option>
                                                <option value="W">직장인</option>
                                                <option value="A">선수</option>
                                                <option value="S">학생</option>
                                                <option value="P">대학원생</option>
                                                <option value="E">기타</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>운동 빈도</label>
                                            <span class="ml-3">
                                                <div class="form-check form-check-inline mt-3">
                                                    <input class="form-check-input" type="radio" name="freq" value="U" />
                                                    <label class="form-check-label">자주</label>
                                                </div>
                                                <div class="form-check form-check-inline mt-3">
                                                    <input class="form-check-input" type="radio" name="freq" value="S" />
                                                    <label class="form-check-label">가끔</label>
                                                </div>
                                                <div class="form-check form-check-inline mt-3">
                                                    <input class="form-check-input" type="radio" name="freq" value="H" />
                                                    <label class="form-check-label">거의 안함</label>
                                                </div>
                                                <div class="form-check form-check-inline mt-3">
                                                    <input class="form-check-input" type="radio" name="freq" value="N" />
                                                    <label class="form-check-label">안함</label>
                                                </div>
                                            </span>
                                        </div>
                                        <!-- <span style="color: red; text-align:center;"><strong>{{ error }}</strong></span> -->
                                        <div class="text-center t-4 pt-5">
                                            <button class="btn btn-primary btn-lg" type="submit" onclick="register();">회원가입</button>
                                        </div>
                                        <script>
                                            $('.pw').focusout( function() {
                                                var pwd1 = $("#pw").val();
                                                var pwd2 = $("#chkpw").val();

                                                var regex = /^[A-Za-z\d]{6,12}$/;
                                                var result = regex.exec(pwd1)
                
                                                if(result != null){
                                                    $(".pw.regex").html("");
                                                }
                                                else {
                                                    $(".pw.regex").html("영어 대소문자, 숫자 6-11자리 섞어서 다시 지으삼");
                                                    return false;
                                                }
                                                
                                                if ( pwd1 != '' && pwd2 == '' ) {
                                                    null;
                                                } else if (pwd1 != "" || pwd2 != "") {
                                                    
                                                    if (pwd1 == pwd2) {
                                                        $("#alert-success").css('display', 'inline-block');
                                                        $("#alert-danger").css('display', 'none');
                                                    } else {
                                                        $("#alert-success").css('display', 'none');
                                                        $("#alert-danger").css('display', 'inline-block');
                                                    }
                                                }
                                            });
                                        </script>
                                        <script>
                                            function check_id() {
                                                $('.userid_input').change(function () {
                                                    $('#id_check_success').hide();
                                                    $('#id_check_fail').hide();
                                                    $('.userid_input').attr("check_result", "fail");
                                                });
                                            
                                                if ($('.userid_input').val() == '') {
                                                    alert('아이디를 입력해주세요!');
                                                    return;
                                                }

                                                overlap_input = document.querySelector('input[name="id"]');

                                                $.ajax({
                                                    url: '../check_id',
                                                    data: {'id': overlap_input.value},
                                                    datatype: 'json',
                                                    
                                                    success: function (data) {
                                                        console.log(data['duplicate_check']);
                                                        if (data['duplicate_check'] == "fail") {
                                                            $('#id_check_success').css('display', 'none');
                                                            $('#id_check_fail').css('display', 'inline-block');
                                                            overlap_input.focus();
                                                            return false;
                                                        }
                                                        else {
                                                            $('.userid_input').attr("check_result", "success");
                                                            $('#id_check_success').css('display', 'inline-block');
                                                            $('#id_check_fail').css('display', 'none');
                                                            return true;
                                                        }
                                                    }
                                                });
                                            }
                                        </script>
                                        <script>
                                            $("#email").focusout("input",function(){
                                                var regex = /.+@[a-z]+(\.[a-z]+){1,2}$/;
                                                var result = regex.exec($("#email").val());
                                                
                                                if (result != null) {
                                                    $(".email.regex").html("");  
                                                }
                                                else {
                                                    $(".email.regex").html("올바른 이메일 형식이 아닌거 같은데?");
                                                }
                                            })
                                        </script>
                                        <script>
                                            $("#pNum").focusout("input",function(){
                                                var regex = /^01\d\d{3,4}\d{4}$/;
                                                var result = regex.exec($("#pNum").val());
                                                
                                                if(result != null) {
                                                    $(".phone.regex").html("");  
                                                }
                                                else {
                                                    $(".phone.regex").html("요즘 휴대폰 번호가 이렇게 생겼나?");
                                                }
                                            })
                                        </script>
                                        <script>
                                            function register(){
                                                if ($('.userid_input').attr("check_result") == "fail"){
                                                    alert("아이디 중복체크를 해야됨. 빡꾸!");
                                                    $('.userid_input').focus();
                                                    return false;
                                                }
                                            }
                                        </script>
                                        {% if messages %}
                                            {% for message in messages %}
                                            <script>
                                                alert('{{ message.tags }} : {{ message.message }}');
                                            </script>
                                            {% endfor %}
                                        {% endif %}
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>